// ==UserScript==
// @name        bilibili屏蔽
// @version     1.0.1658429489095
// @author      zzxt0019
// @match       *://www.bilibili.com/*
// @match       *://search.bilibili.com/*
// @match       *://live.bilibili.com/*
// @match       *://space.bilibili.com/*
// @match       *://t.bilibili.com/*
// @match       *://h.bilibili.com/*
// @match       *://manga.bilibili.com/*
// @match       *://message.bilibili.com/*
// @noframes
// @description bilibili屏蔽
// @grant       GM_setValue
// @grant       GM_getValue
// @grant       GM_deleteValue
// @grant       GM_registerMenuCommand
// ==/UserScript==
(()=>{var R={640:()=>{var A=function(g,b,y){"use strict";if(!g.MutationObserver||typeof HTMLElement=="undefined")return;var C=0,o=function(){var d=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(l,u){return l instanceof HTMLElement&&d.call(l,u)},addMethod:function(l,u,f){var a=l[u];l[u]=function(){if(f.length==arguments.length)return f.apply(this,arguments);if(typeof a=="function")return a.apply(this,arguments)}},callCallbacks:function(l,u){u&&u.options.onceOnly&&u.firedElems.length==1&&(l=[l[0]]);for(var f=0,a;a=l[f];f++)a&&a.callback&&a.callback.call(a.elem,a.elem);u&&u.options.onceOnly&&u.firedElems.length==1&&u.me.unbindEventWithSelectorAndCallback.call(u.target,u.selector,u.callback)},checkChildNodesRecursively:function(l,u,f,a){for(var i=0,t;t=l[i];i++)f(t,u,a)&&a.push({callback:u.callback,elem:t}),t.childNodes.length>0&&o.checkChildNodesRecursively(t.childNodes,u,f,a)},mergeArrays:function(l,u){var f={},a;for(a in l)l.hasOwnProperty(a)&&(f[a]=l[a]);for(a in u)u.hasOwnProperty(a)&&(f[a]=u[a]);return f},toElementsArray:function(l){return typeof l!="undefined"&&(typeof l.length!="number"||l===g)&&(l=[l]),l}}}(),V=function(){var d=function(){this._eventsBucket=[],this._beforeAdding=null,this._beforeRemoving=null};return d.prototype.addEvent=function(l,u,f,a){var i={target:l,selector:u,options:f,callback:a,firedElems:[]};return this._beforeAdding&&this._beforeAdding(i),this._eventsBucket.push(i),i},d.prototype.removeEvent=function(l){for(var u=this._eventsBucket.length-1,f;f=this._eventsBucket[u];u--)if(l(f)){this._beforeRemoving&&this._beforeRemoving(f);var a=this._eventsBucket.splice(u,1);a&&a.length&&(a[0].callback=null)}},d.prototype.beforeAdding=function(l){this._beforeAdding=l},d.prototype.beforeRemoving=function(l){this._beforeRemoving=l},d}(),w=function(d,l){var u=new V,f=this,a={fireOnAttributesModification:!1};return u.beforeAdding(function(i){var t=i.target,c;(t===g.document||t===g)&&(t=document.getElementsByTagName("html")[0]),c=new MutationObserver(function(e){l.call(this,e,i)});var m=d(i.options);c.observe(t,m),i.observer=c,i.me=f}),u.beforeRemoving(function(i){i.observer.disconnect()}),this.bindEvent=function(i,t,c){t=o.mergeArrays(a,t);for(var m=o.toElementsArray(this),e=0;e<m.length;e++)u.addEvent(m[e],i,t,c)},this.unbindEvent=function(){var i=o.toElementsArray(this);u.removeEvent(function(t){for(var c=0;c<i.length;c++)if(this===y||t.target===i[c])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function(i){var t=o.toElementsArray(this),c=i,m;typeof i=="function"?m=function(e){for(var r=0;r<t.length;r++)if((this===y||e.target===t[r])&&e.callback===c)return!0;return!1}:m=function(e){for(var r=0;r<t.length;r++)if((this===y||e.target===t[r])&&e.selector===i)return!0;return!1},u.removeEvent(m)},this.unbindEventWithSelectorAndCallback=function(i,t){var c=o.toElementsArray(this);u.removeEvent(function(m){for(var e=0;e<c.length;e++)if((this===y||m.target===c[e])&&m.selector===i&&m.callback===t)return!0;return!1})},this},_=function(){var d={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function l(i){var t={attributes:!1,childList:!0,subtree:!0};return i.fireOnAttributesModification&&(t.attributes=!0),t}function u(i,t){i.forEach(function(c){var m=c.addedNodes,e=c.target,r=[],n;m!==null&&m.length>0?o.checkChildNodesRecursively(m,t,f,r):c.type==="attributes"&&f(e,t,r)&&r.push({callback:t.callback,elem:e}),o.callCallbacks(r,t)})}function f(i,t,c){return o.matchesSelector(i,t.selector)&&(i._id===y&&(i._id=C++),t.firedElems.indexOf(i._id)==-1)?(t.firedElems.push(i._id),!0):!1}M=new w(l,u);var a=M.bindEvent;return M.bindEvent=function(i,t,c){typeof c=="undefined"?(c=t,t=d):t=o.mergeArrays(d,t);var m=o.toElementsArray(this);if(t.existing){for(var e=[],r=0;r<m.length;r++)for(var n=m[r].querySelectorAll(i),s=0;s<n.length;s++)e.push({callback:c,elem:n[s]});if(t.onceOnly&&e.length)return c.call(e[0].elem,e[0].elem);setTimeout(o.callCallbacks,1,e)}a.call(this,i,t,c)},M},L=function(){var d={};function l(){var i={childList:!0,subtree:!0};return i}function u(i,t){i.forEach(function(c){var m=c.removedNodes,e=[];m!==null&&m.length>0&&o.checkChildNodesRecursively(m,t,f,e),o.callCallbacks(e,t)})}function f(i,t){return o.matchesSelector(i,t.selector)}p=new w(l,u);var a=p.bindEvent;return p.bindEvent=function(i,t,c){typeof c=="undefined"?(c=t,t=d):t=o.mergeArrays(d,t),a.call(this,i,t,c)},p},M=new _,p=new L;function v(d,l,u){o.addMethod(l,u,d.unbindEvent),o.addMethod(l,u,d.unbindEventWithSelectorOrCallback),o.addMethod(l,u,d.unbindEventWithSelectorAndCallback)}function k(d){d.arrive=M.bindEvent,v(M,d,"unbindArrive"),d.leave=p.bindEvent,v(p,d,"unbindLeave")}b&&k(b.fn),k(HTMLElement.prototype),k(NodeList.prototype),k(HTMLCollection.prototype),k(HTMLDocument.prototype),k(Window.prototype);var E={};return v(M,E,"unbindAllArrive"),v(p,E,"unbindAllLeave"),E}(window,typeof jQuery=="undefined"?null:jQuery,void 0)}},S={};function N(A){var g=S[A];if(g!==void 0)return g.exports;var b=S[A]={exports:{}};return R[A](b,b.exports,N),b.exports}var B={};(()=>{"use strict";var A=N(640);let g=["\u4E43\u7433","\u5411\u665A","\u8D1D\u62C9","\u73C8\u4E50","\u5609\u7136"],b=[730732],y=["\u660E\u65E5\u65B9\u821F"];function C(){GM_getValue("matches")||GM_setValue("matches",y),GM_registerMenuCommand("\u6DFB\u52A0\u5339\u914D",()=>{let r=prompt(`matches:
            ${GM_getValue("matches",[]).join(",")}`);if(r){let n=GM_getValue("matches");n.push(...r.split(" ")),GM_setValue("matches",n)}}),GM_registerMenuCommand("\u5220\u9664\u5339\u914D",()=>{let r=prompt(`matches:
            ${GM_getValue("matches",[]).join(",")}`);if(r){let n=new Set(r.split(" "));GM_setValue("matches",GM_getValue("matches").filter(s=>!n.has(s)))}}),GM_registerMenuCommand("\u5C55\u793A\u5339\u914D",()=>{alert(`matches:
            ${GM_getValue("matches",[]).join(",")}`)})}function o(e){if(e){for(const r of GM_getValue("matches",[]))if(e.includes(r))return!0}return!1}function V(){GM_getValue("uids")||GM_setValue("uids",b),GM_registerMenuCommand("\u6DFB\u52A0up",()=>{let r=GM_getValue("uids",[]).map(s=>`${s}(${_(s)})`).join(","),n=prompt(`uid:
            ${r}`);if(n){let s=n.split(" ").map(Number),h=GM_getValue("uids");h.push(...s),GM_setValue("uids",h);for(const G of s)setTimeout(_(G))}}),GM_registerMenuCommand("\u5220\u9664up",()=>{let r=GM_getValue("uids",[]).map(s=>`${s}(${_(s)})`).join(","),n=prompt(`uid:
            ${r}`);if(n){let s=new Set(n.split(" ").map(Number));GM_setValue("uids",GM_getValue("uids").filter(h=>!s.has(h)));for(const h of s)GM_deleteValue("uid_"+h)}}),GM_registerMenuCommand("\u5C55\u793Aup",()=>{let r=GM_getValue("uids",[]).map(n=>`${n}(${_(n)})`).join(",");alert(`uid:
            ${r}`)})}class w{constructor(r,n,s){this.uid=r,this.username=n,this.expiretime=s}}function _(e){let n=GM_getValue("uid_"+e);if(n&&new Date().getTime()<n.expiretime)return n.username;{let s=new XMLHttpRequest;s.open("GET","https://api.bilibili.com/x/space/acc/info?mid="+e,!1),s.send(null);let h=JSON.parse(s.responseText).data.name;return n={uid:e,username:h,expiretime:new Date().getTime()+Math.random()*24*60*60*1e3},GM_setValue("uid_"+e,n),n.username}}function L(e){return e?GM_getValue("uids",[]).includes(e):!1}function M(e){return e?GM_getValue("uids",[]).map(_).includes(e):!1}function p(e){if(e){for(const r of GM_getValue("uids",[]).map(_))if(e.includes(r))return!0}return!1}let v=new Map;function k(){t(".chat-item.danmaku-item",void 0,e=>o(e.getAttribute("data-danmaku"))),t(".bilibili-danmaku.mode-roll",void 0,e=>o(e.getAttribute("data-danmaku"))),t(".chat-item.danmaku-item",void 0,e=>{var r;if(L(Number((r=e.querySelector("[data-anchor-id]"))==null?void 0:r.getAttribute("data-anchor-id"))))try{let n=String(e.getAttribute("data-danmaku")),s=v.get(n);v.set(n,s?s+1:1);let h=document.querySelectorAll(".bilibili-danmaku.mode-roll");for(let G=0;G<h.length;G++){const O=h[G];if(O.innerHTML===n){O.remove(),v.get(n)===1?v.delete(n):v.set(n,v.get(n)-1);break}}}catch(n){console.error(n)}finally{return console.log(!0,e),!0}return!1}),t(".bilibili-danmaku.mode-roll",void 0,e=>{let r=e.innerHTML,n=v.get(r);return n?(v.set(r,n-1),!0):!1})}function E(){t(".rank-wrap",".info .name",e=>M(e.innerHTML)),t(".rank-wrap",".title",e=>o(e.getAttribute("title"))),t(".pgc-rank",".title",e=>o(e.getAttribute("title"))),t(".manga-rank-item",".title",e=>o(e.getAttribute("title"))),t(".video-card-reco","img",e=>o(e.getAttribute("alt"))),t(".van-slide .item","img",e=>o(e.getAttribute("alt"))),t(".van-slide .item","i.bypb-icon",()=>!0),t(".video-card-common","a.title",e=>o(e.getAttribute("title"))),t(".video-card-common","a.up",e=>p(e.innerHTML)),t(".video-card-common",".gg-normal-icon",()=>!0),t(".article-card",".title",e=>o(e.getAttribute("title"))),t(".article-card","a.up",e=>p(e.innerHTML)),t("a.banner-card.b-wrap",".gg-icon",()=>!0)}function d(){GM_getValue("cards")||GM_setValue("cards",g),GM_registerMenuCommand("\u6DFB\u52A0\u5361\u7247",()=>{let r=prompt(`card:
            ${GM_getValue("cards",[]).join(",")}`);if(r){let n=GM_getValue("cards");n.push(...r.split(" ")),GM_setValue("cards",n)}}),GM_registerMenuCommand("\u5220\u9664\u5361\u7247",()=>{let r=prompt(`card:
            ${GM_getValue("cards",[]).join(",")}`);if(r){let n=new Set(r.split(" "));GM_setValue("cards",GM_getValue("cards").filter(s=>!n.has(s)))}}),GM_registerMenuCommand("\u5C55\u793A\u5361\u7247",()=>{alert(`card:
            ${GM_getValue("cards",[]).join(",")}`)})}function l(e){if(e){for(const r of GM_getValue("cards",[]))if(e.includes(r))return!0}return!1}function u(){t(".list-item",".sailing-img",e=>l(e.getAttribute("alt"))),t(".list-item","p.text img",e=>l(e.getAttribute("alt"))),t(".reply-item","img",e=>l(e.getAttribute("alt"))),t("a.ad-report",void 0,e=>(e.attributeStyleMap.set("display","none"),!1))}class f{constructor(r,n){this.innerSelector=r,this.bingo=n}check(r){if(this.innerSelector){let n=r.querySelectorAll(this.innerSelector);for(let s=0;s<n.length;s++){const h=n[s];if(this.bingo(h))return!0}}else if(this.bingo(r))return!0;return!1}}class a{constructor(r,n){this.mainSelector=r,this.checkers=n}ifRemove(r){for(const n of this.checkers)if(n.check(r))return!0;return!1}}let i=new Map;function t(e,r,n){let s=i.get(e),h=s||[];h.push(new f(r,n)),s||i.set(e,h)}function c(){E(),u(),k();let e=[];return i.forEach((r,n)=>{e.push(new a(n,r))}),e}m();function m(){d(),V(),C();for(const e of c())document.arrive(e.mainSelector,{fireOnAttributesModification:!0,onceOnly:!1,existing:!0},r=>{e.ifRemove(r)&&r.remove()})}})()})();
